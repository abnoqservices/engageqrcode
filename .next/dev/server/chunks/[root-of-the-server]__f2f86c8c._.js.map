{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/D/next/engage-update/app/api/upload-images/route.ts"],"sourcesContent":["// app/api/upload-images/route.ts\nimport { NextRequest, NextResponse } from 'next/server';\nimport { writeFile, mkdir } from 'fs/promises';\nimport path from 'path';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const data = await request.json();\n    const { images, gallery, pdfs } = data;\n    \n    // Ensure upload directories exist\n    const imageUploadDir = path.join(process.cwd(), 'public', 'upload', 'productgallery');\n    const pdfUploadDir = path.join(process.cwd(), 'public', 'upload', 'productdocs');\n    \n    await mkdir(imageUploadDir, { recursive: true });\n    await mkdir(pdfUploadDir, { recursive: true });\n    \n    const savedImages: any[] = [];\n    const savedGallery: any[] = [];\n    const savedPdfs: any[] = [];\n    \n    // Process product images\n    if (images && Array.isArray(images)) {\n      for (const img of images) {\n        if (img.base64 && img.base64.startsWith('data:')) {\n          // Extract base64 data\n          const base64Data = img.base64.split(',')[1];\n          const buffer = Buffer.from(base64Data, 'base64');\n          \n          // Generate unique filename\n          const timestamp = Date.now();\n          const randomStr = Math.random().toString(36).substring(2, 8);\n          const ext = img.name.split('.').pop() || 'jpg';\n          const filename = `product-${timestamp}-${randomStr}.${ext}`;\n          const filepath = path.join(imageUploadDir, filename);\n          \n          // Save file\n          await writeFile(filepath, buffer);\n          \n          savedImages.push({\n            id: img.id,\n            name: img.name,\n            url: `/upload/productgallery/${filename}`,\n            savedPath: filepath\n          });\n        }\n      }\n    }\n    \n    // Process gallery images\n    if (gallery && Array.isArray(gallery)) {\n      for (const img of gallery) {\n        if (img.base64 && img.base64.startsWith('data:')) {\n          const base64Data = img.base64.split(',')[1];\n          const buffer = Buffer.from(base64Data, 'base64');\n          \n          const timestamp = Date.now();\n          const randomStr = Math.random().toString(36).substring(2, 8);\n          const ext = img.name.split('.').pop() || 'jpg';\n          const filename = `gallery-${timestamp}-${randomStr}.${ext}`;\n          const filepath = path.join(imageUploadDir, filename);\n          \n          await writeFile(filepath, buffer);\n          \n          savedGallery.push({\n            id: img.id,\n            name: img.name,\n            url: `/upload/productgallery/${filename}`,\n            savedPath: filepath\n          });\n        }\n      }\n    }\n    \n    // Process PDF documents\n    if (pdfs && Array.isArray(pdfs)) {\n      for (const pdf of pdfs) {\n        if (pdf.base64 && pdf.base64.startsWith('data:')) {\n          const base64Data = pdf.base64.split(',')[1];\n          const buffer = Buffer.from(base64Data, 'base64');\n          \n          const timestamp = Date.now();\n          const randomStr = Math.random().toString(36).substring(2, 8);\n          // Sanitize filename - remove special characters\n          const sanitizedName = pdf.name.replace(/[^a-zA-Z0-9.-]/g, '_');\n          const nameWithoutExt = sanitizedName.replace('.pdf', '');\n          const filename = `${nameWithoutExt}-${timestamp}-${randomStr}.pdf`;\n          const filepath = path.join(pdfUploadDir, filename);\n          \n          await writeFile(filepath, buffer);\n          \n          savedPdfs.push({\n            id: pdf.id,\n            name: pdf.name,\n            url: `/upload/productdocs/${filename}`,\n            size: pdf.size || buffer.length,\n            savedPath: filepath\n          });\n        }\n      }\n    }\n    \n    return NextResponse.json({\n      success: true,\n      message: 'Files saved successfully',\n      data: {\n        images: savedImages,\n        gallery: savedGallery,\n        pdfs: savedPdfs\n      }\n    });\n    \n  } catch (error: any) {\n    console.error('Error saving files:', error);\n    return NextResponse.json(\n      { success: false, message: error.message || 'Failed to save files' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":"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"}}]
}